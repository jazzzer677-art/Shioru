--// üü£ ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ
getgenv().Silent = getgenv().Silent or {
    Settings = {
        Toggled = true,
        AimPart = "HumanoidRootPart",
        HitChance = 9999,
        Prediction = {
            Toggled = true,
            Value = 0.1242231,
            AutoPred = false,
            JumpOffset = 0.07,
            AntiGroundShots = true,
            Resolve = false,
        },
        Circle = {
            Visible = false,
            Transparency = 0.5,
            Thickness = 3,
            NumSides = 100,
            Radius = 300,
            Filled = false,
        },
        RainbowTarget = false,
        WallCheck = false,
    }
}

--// üß© Services
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local lp = Players.LocalPlayer

--// üü£ Highlight Settings
local FillColor = Color3.fromRGB(175, 25, 255)
local DepthMode = "AlwaysOnTop"
local FillTransparency = 0.5
local OutlineColor = Color3.fromRGB(255, 255, 255)
local OutlineTransparency = 0

--// Folder ‡πÄ‡∏Å‡πá‡∏ö Highlight
local Storage = Instance.new("Folder")
Storage.Name = "Highlight_Storage"
Storage.Parent = CoreGui

local highlights, connections = {}, {}

--// üîò FOV Circle
local circleConfig = getgenv().Silent.Settings.Circle
local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = circleConfig.Visible
FOVCircle.Transparency = circleConfig.Transparency
FOVCircle.Thickness = circleConfig.Thickness
FOVCircle.NumSides = circleConfig.NumSides
FOVCircle.Radius = circleConfig.Radius
FOVCircle.Filled = circleConfig.Filled
FOVCircle.Color = Color3.fromRGB(255, 255, 255)

--// üü£ ‡∏™‡∏£‡πâ‡∏≤‡∏á Highlight
local function CreateHighlight(plr)
    local hl = Instance.new("Highlight")
    hl.Name = plr.Name
    hl.FillColor = FillColor
    hl.DepthMode = DepthMode
    hl.FillTransparency = FillTransparency
    hl.OutlineColor = OutlineColor
    hl.OutlineTransparency = OutlineTransparency
    hl.Enabled = false
    hl.Parent = Storage

    if plr.Character then
        hl.Adornee = plr.Character
    end

    connections[plr] = plr.CharacterAdded:Connect(function(char)
        hl.Adornee = char
    end)

    highlights[plr] = hl
end

--// üë• Player Added/Removed
Players.PlayerAdded:Connect(CreateHighlight)
for _,v in pairs(Players:GetPlayers()) do
    if v ~= lp then
        CreateHighlight(v)
    end
end

Players.PlayerRemoving:Connect(function(plr)
    if highlights[plr] then
        highlights[plr]:Destroy()
        highlights[plr] = nil
    end
    if connections[plr] then
        connections[plr]:Disconnect()
        connections[plr] = nil
    end
end)

--// üîç ‡∏´‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î‡πÉ‡∏ô FOV
local function GetNearestTargetInFOV()
    local mousePos = UserInputService:GetMouseLocation()
    local nearestTarget, nearestDist = nil, math.huge
    local radius = getgenv().Silent.Settings.Circle.Radius

    for plr, hl in pairs(highlights) do
        if plr ~= lp and plr.Character and plr.Character:FindFirstChild(getgenv().Silent.Settings.AimPart) then
            local part = plr.Character[getgenv().Silent.Settings.AimPart]
            local screenPos, onScreen = Camera:WorldToViewportPoint(part.Position)
            if onScreen then
                local dist = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
                if dist <= radius and dist < nearestDist then
                    nearestDist = dist
                    nearestTarget = plr
                end
            end
        end
    end

    return nearestTarget
end

--// üî´ ‡∏¢‡∏¥‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
local function SilentShoot(target)
    if not target then return end
    local settings = getgenv().Silent.Settings
    local char = target.Character
    if not char or not char:FindFirstChild(settings.AimPart) then return end

    local part = char[settings.AimPart]
    local pos = part.Position

    -- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° Prediction
    if settings.Prediction.Toggled then
        local hrp = target.Character:FindFirstChild("HumanoidRootPart")
        if hrp and hrp.Velocity then
            pos = pos + hrp.Velocity * settings.Prediction.Value
        end
    end

    local args = {
        "MOUSE",
        pos
    }

    local mainEvent = ReplicatedStorage:FindFirstChild("MAINEVENT")
    if mainEvent then
        mainEvent:FireServer(unpack(args))
    end
end

--// üîÅ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å‡πÄ‡∏ü‡∏£‡∏°
RunService.RenderStepped:Connect(function()
    local settings = getgenv().Silent.Settings
    local mousePos = UserInputService:GetMouseLocation()
    FOVCircle.Position = Vector2.new(mousePos.X, mousePos.Y)

    -- ‡∏´‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÉ‡∏ô‡∏ß‡∏á
    local target = GetNearestTargetInFOV()

    -- ‡∏õ‡∏¥‡∏î Highlight ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô
    for _, hl in pairs(highlights) do
        hl.Enabled = false
    end

    -- ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
    if target and highlights[target] then
        highlights[target].Enabled = true
    end

    -- ‡∏¢‡∏¥‡∏á‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    if settings.Toggled and target then
        SilentShoot(target)
    end
end)
