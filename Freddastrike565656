--// üü£ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á Highlight
local FillColor = Color3.fromRGB(175, 25, 255)
local DepthMode = "AlwaysOnTop"
local FillTransparency = 0.5
local OutlineColor = Color3.fromRGB(255, 255, 255)
local OutlineTransparency = 0

--// üß© ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local lp = Players.LocalPlayer
local connections = {}

--// üóÇ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö Highlight
local Storage = Instance.new("Folder")
Storage.Parent = CoreGui
Storage.Name = "Highlight_Storage"

--// üéØ ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤
local LockedTarget = nil

--// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Highlight
local function Highlight(plr)
	local Highlight = Instance.new("Highlight")
	Highlight.Name = plr.Name
	Highlight.FillColor = FillColor
	Highlight.DepthMode = DepthMode
	Highlight.FillTransparency = FillTransparency
	Highlight.OutlineColor = OutlineColor
	Highlight.OutlineTransparency = OutlineTransparency
	Highlight.Parent = Storage
	
	if plr.Character then
		Highlight.Adornee = plr.Character
	end
	
	connections[plr] = plr.CharacterAdded:Connect(function(char)
		Highlight.Adornee = char
	end)
end

--// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤
Players.PlayerAdded:Connect(Highlight)
for i,v in pairs(Players:GetPlayers()) do
	if v ~= lp then
		Highlight(v)
	end
end

--// ‡∏•‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏Å
Players.PlayerRemoving:Connect(function(plr)
	if Storage:FindFirstChild(plr.Name) then
		Storage[plr.Name]:Destroy()
	end
	if connections[plr] then
		connections[plr]:Disconnect()
	end
	if LockedTarget == plr then
		LockedTarget = nil
	end
end)

--// üîí ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤ (‡∏Å‡∏î Q)
UserInputService.InputBegan:Connect(function(input, processed)
	if processed then return end
	if input.KeyCode == Enum.KeyCode.Q then
		if LockedTarget then
			print("üîì ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤: " .. LockedTarget.Name)
			LockedTarget = nil
		else
			-- ‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
			local nearest, nearestDist = nil, math.huge
			for _, plr in pairs(Players:GetPlayers()) do
				if plr ~= lp and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
					local hrp = plr.Character.HumanoidRootPart
					local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
					if onScreen then
						local mousePos = UserInputService:GetMouseLocation()
						local dist = (Vector2.new(pos.X, pos.Y) - mousePos).Magnitude
						if dist < nearestDist and dist < 200 then -- ‡∏£‡∏∞‡∏¢‡∏∞‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
							nearest = plr
							nearestDist = dist
						end
					end
				end
			end

			if nearest then
				LockedTarget = nearest
				print("üéØ ‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤: " .. nearest.Name)
			end
		end
	end
end)

--// üì∑ ‡∏´‡∏°‡∏∏‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß
RunService.RenderStepped:Connect(function()
	if LockedTarget and LockedTarget.Character and LockedTarget.Character:FindFirstChild("HumanoidRootPart") and LockedTarget.Character:FindFirstChild("Humanoid") then
		local hrp = LockedTarget.Character.HumanoidRootPart
		local humanoid = LockedTarget.Character.Humanoid
		
		-- ‡∏´‡∏≤‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà
		local moveDir = humanoid.MoveDirection
		local right = hrp.CFrame.RightVector
		local up = Vector3.new(0, 3, 0) -- ‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô 3 studs

		-- offset ‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏≤‡∏°‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á X
		local sideOffset = right * moveDir.X * 3
		local targetPos = hrp.Position + up + sideOffset

		-- ‡∏´‡∏°‡∏∏‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß
		Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPos)
	end
end)
