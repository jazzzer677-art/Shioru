--// üü£ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Highlight
local FillColor = Color3.fromRGB(175, 25, 255)
local DepthMode = "AlwaysOnTop"
local FillTransparency = 0.5
local OutlineColor = Color3.fromRGB(255, 255, 255)
local OutlineTransparency = 0

--// ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local lp = Players.LocalPlayer
local connections = {}
local highlights = {}

--// ‡∏™‡∏£‡πâ‡∏≤‡∏á Folder ‡πÄ‡∏Å‡πá‡∏ö Highlight
local Storage = Instance.new("Folder")
Storage.Parent = CoreGui
Storage.Name = "Highlight_Storage"

--// FOV settings
local FOVRadius = 150 -- ‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏ß‡∏á‡∏Å‡∏•‡∏° FOV
local FOVCircle = Drawing.new("Circle")
FOVCircle.Radius = FOVRadius
FOVCircle.Color = Color3.fromRGB(255, 0, 0)
FOVCircle.Thickness = 2
FOVCircle.Filled = false
FOVCircle.Transparency = 0.5

--// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Highlight
local function CreateHighlight(plr)
    local Highlight = Instance.new("Highlight")
    Highlight.Name = plr.Name
    Highlight.FillColor = FillColor
    Highlight.DepthMode = DepthMode
    Highlight.FillTransparency = FillTransparency
    Highlight.OutlineColor = OutlineColor
    Highlight.OutlineTransparency = OutlineTransparency
    Highlight.Parent = Storage

    if plr.Character then  
        Highlight.Adornee = plr.Character  
    end  
    
    connections[plr] = plr.CharacterAdded:Connect(function(char)  
        Highlight.Adornee = char  
    end)

    highlights[plr] = Highlight
end

-- ‡∏™‡∏£‡πâ‡∏≤‡∏á Highlight ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
Players.PlayerAdded:Connect(CreateHighlight)
for _,v in pairs(Players:GetPlayers()) do
    if v ~= lp then
        CreateHighlight(v)
    end
end

Players.PlayerRemoving:Connect(function(plr)
    if highlights[plr] then
        highlights[plr]:Destroy()
        highlights[plr] = nil
    end
    if connections[plr] then
        connections[plr]:Disconnect()
        connections[plr] = nil
    end
end)

--// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô FOV
local function GetNearestTargetInFOV()
    local mousePos = UserInputService:GetMouseLocation()
    local nearest, nearestDist = nil, math.huge

    for plr, hl in pairs(highlights) do
        if plr ~= lp and plr.Character and plr.Character:FindFirstChild("Head") then
            local head = plr.Character.Head
            local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
            if onScreen then
                local dist = (Vector2.new(pos.X, pos.Y) - mousePos).Magnitude
                if dist <= FOVRadius then
                    nearest = plr
                    nearestDist = dist
                    -- ‡πÅ‡∏™‡∏î‡∏á Highlight ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô FOV
                    hl.Enabled = true
                else
                    hl.Enabled = false
                end
            else
                hl.Enabled = false
            end
        end
    end

    return nearest
end

--// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡∏¥‡∏á Silent Aim
local function Shoot()
    local target = GetNearestTargetInFOV()
    if target and target.Character and target.Character:FindFirstChild("Head") then
        local args = {
            "MOUSE",
            target.Character.Head.Position
        }
        local mainEvent = game:GetService("ReplicatedStorage"):FindFirstChild("MAINEVENT")
        if mainEvent then
            mainEvent:FireServer(unpack(args))
        end
    end
end

--// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï FOV ‡πÅ‡∏•‡∏∞ AutoShoot
RunService.RenderStepped:Connect(function()
    local mousePos = UserInputService:GetMouseLocation()
    FOVCircle.Position = Vector2.new(mousePos.X, mousePos.Y)

    if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
        Shoot()
    else
        -- ‡∏õ‡∏¥‡∏î Highlight ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô FOV
        for plr, hl in pairs(highlights) do
            if hl.Enabled then
                local head = plr.Character and plr.Character:FindFirstChild("Head")
                if head then
                    local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
                    local dist = (Vector2.new(pos.X, pos.Y) - mousePos).Magnitude
                    if dist > FOVRadius or not onScreen then
                        hl.Enabled = false
                    end
                end
            end
        end
    end
end)
